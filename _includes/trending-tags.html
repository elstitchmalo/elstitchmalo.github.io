<!-- Trending tags (posts + academia) -->

{% assign MAX = 10 %}
{% assign all_items = site.posts | concat: site.academia %}
{% assign tags = '' | split: '' %}

{%- comment -%}
  1. Obtener lista Ãºnica de tags
{%- endcomment -%}
{% for item in all_items %}
  {% if item.tags %}
    {% for t in item.tags %}
      {% unless tags contains t %}
        {% assign tags = tags | push: t %}
      {% endunless %}
    {% endfor %}
  {% endif %}
{% endfor %}

{%- comment -%}
  2. Crear pares "count::tag"
{%- endcomment -%}
{% assign tag_pairs = '' | split: '' %}

{% for t in tags %}
  {% assign count = 0 %}
  {% for item in all_items %}
    {% if item.tags contains t %}
      {% assign count = count | plus: 1 %}
    {% endif %}
  {% endfor %}
  {% assign pair = count | append: '::' | append: t %}
  {% assign tag_pairs = tag_pairs | push: pair %}
{% endfor %}

{%- comment -%}
  3. Ordenar por count (desc)
{%- endcomment -%}
{% assign tag_pairs = tag_pairs | sort | reverse %}

{% if tag_pairs.size > 0 %}
<section>
  <h2 class="panel-heading">
    {{- site.data.locales[include.lang].panel.trending_tags | escape -}}
  </h2>

  <div class="d-flex flex-wrap mt-3 mb-1 me-3">
    {% for pair in tag_pairs limit: MAX %}
      {% assign parts = pair | split: '::' %}
      {% assign tag_name = parts[1] %}
      <a class="post-tag btn btn-outline-primary"
         href="{{ tag_name | slugify | url_encode | prepend: '/tags/' | append: '/' | relative_url }}">
        {{ tag_name | escape }}
      </a>
    {% endfor %}
  </div>
</section>
{% endif %}
